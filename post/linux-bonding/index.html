<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Linux Bonding |  ROOT BLOG</title>
    <meta name="description" content="DEVPIA">
    <meta name="author" content="Jaehun Park">
    <meta name="keywords" content="javascript,php5,html,gcc,mfc,bc" />
    <meta name="generator" content="haroopress v0.9.2" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <link href="/rss.xml" rel="alternate" title="ROOT BLOG" type="application/rss+xml">

    <!-- Le styles -->
    <link rel="canonical" href="http://www.root.so">

    <link href="/css/bootstrap.min.css" rel="stylesheet">
    <link href="/css/bootstrap-responsive.css" rel="stylesheet">
    <link href="/css/font-awesome.css" rel="stylesheet">
    <link href="/css/markdown.css" rel="stylesheet">
    <link href="/css/haroopress.css" rel="stylesheet">
    <link href="/css/theme.css" rel="stylesheet">
    <link href="/css/code/default.css" rel="stylesheet">
    
    <!-- Le fav and touch icons -->
    <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico">
    <link rel="apple-touch-icon" sizes="72x72" href="/favicon-64.png">

    <!-- Le javascript -->
    <script src="/js/jquery.min.js"></script>
    <script src="/js/bootstrap.min.js"></script>
    <script src="/js/jquery.jsonp.js"></script>
    <script src="/js/mustache.js"></script>
    <script src="/js/apps/github.js"></script>
    <script src="/js/apps/twitter.js"></script>
</head>
<body data-spy="scroll" data-target=".subnav" data-offset="50">

        <div class="navbar navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container">
          <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </a>

          <a class="pull-right" href="/rss.xml"><span class="icon-rss"></span></a>
          

          <div class="nav-collapse">
            <ul class="nav">
              <li>
                <a href="/">Home</a>
              </li>
              <li>
                <a href="/archives">Archives</a>
              </li>
              <li>
                <a href="/slides">Slides</a>
              </li>
                
            </ul>
          </div>
        </div>
      </div>
    </div>


    
<link href="/css/code/default.css" rel="stylesheet">
<div class="container page-archive">
    <div class="row">
        <div class="span3">
            <div id="author" class="well">
                <div>
                    <h3>About Author</h3>
                    <ul class="thumbnails">
                        <li>
                            <a class="thumbnail">
                                <img src="http://www.gravatar.com/avatar/f3d2e68249c5097e024ea895fcf5481d?r=pg&amp;s=128.jpg&amp;d=identicon" />
                            </a>
                        </li>
                    </ul>
                    <p>
                        <strong>JaehunPark</strong><br/>
                        blog: <a href="http://root.so" target="_blank">http://root.so</a><br/>
                        twitter: <a href="http://twitter.com/jaehun" target="_blank">@jaehun</a><br/>
                        github: <a href="https://github.com/jpnetwork" target="_blank">jpnetwork</a>
                    </p>
                    <p>
                        <a href="https://twitter.com/jaehun" class="twitter-follow-button" data-show-count="true">Follow @jaehun</a>
                        <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
                    </p>
                    <p>
                        <p>We can do it for anything!</p>
                    </p>
                </div>
                <div>
                    <h3>About this Article</h3>
                    <p>
                        <h5>Date Released:</h5>
                        <span>Tuesday, December 18 2012 9:25 AM</span>
                    </p>
                </div>
            </div>
                        <div class="well">
                <ul class="nav nav-list">
                    <li class="nav-header">Categories</li>
                    <li class=""><a href="/category"><i class="icon-home"></i> Home</a></li>
                    
                    <li><a href="/category/apple"><i class="icon-book"></i> apple</a></li>
                    
                    <li><a href="/category/linux"><i class="icon-book"></i> linux</a></li>
                    
                </ul>
            </div>

            
<div class="well">
    <ul class="nav nav-list">
        <li class="nav-header">Recent Articles</li>
    
        <li>
            <a href="/post/how-to-clear-command-line-history" target="_blank">커맨드라인 히스토리 깨끗이 지우는 방법
            <span class="label">JaehunPark</span></a>
        </li>
    
        <li>
            <a href="/post/linux-bonding" target="_blank">Linux Bonding
            <span class="label">JaehunPark</span></a>
        </li>
    
        <li>
            <a href="/post/welcome-to-haroopress" target="_blank">Welcome to haroopress
            <span class="label">JaehunPark</span></a>
        </li>
    
    </ul>
</div>

        </div>
        <div class="span9">
            <div class="row">
                <div class="span9">
                    <div class="well bg">
                        
                        <div class="page-header">
                            <h1>Linux Bonding</h1>
                        </div>

                        <div class="pull-right social-area">
                                                
                                                

                            
                        </div>

                        <div class="markdown-wrapper">
                            <h3 id="toc_2">이 글은 리눅스를 공부하시는 분들을 위하여 올립니다. 참고 하시기 바랍니다.</h3>

<h3 id="toc_3">본딩(Bonding)이란?</h3>
<p>여러개의 NIC을 이용하여 하나의 NIC으로 묶어서 사용하는 기술이며, 유용히 사용되어지고 있는 기술입니다. 
본딩 방법은 추후 따로 작성하여 올릴 예정이나, 우선 모드에 대하여 어떤 것이 있는지 확인해보시기 바랍니다.</p><p>이는 모드에 따라서 여러 유형으로 변경될 수 있습니다.</p><p><code>Mode 0 (balance-rr)</code></p><p>balance-round robine ( 2개의 NIC을 순차적으로 분배 + Fault Tolerance)</p><p>회선이 2회선일 경우 트래픽을 같이 사용할 수 있어 대역폭을 분산시키는데 효율적입니다. </p><p>[ A nic -&gt; B nic -&gt; A nic -&gt; B nic 순] 으로 패킷을 분산 시키는 방법입니다.</p><p>또한, 장애허용으로 인하여, 한쪽 네트워크에 단절이 오더라도 이를 보안하는 기능이 존재 합니다.</p><p><code>Mode 1 (active-backup)</code></p><p>일반 기업들이 많이 쓰고, 흔히들 말하는 네트워크 이중화에 대한 부분으로 사용되어집니다.</p><p>실제 사용시에는 2개의 백본에 2개의 NIC에 연결이 되며, 활성화 되어있는 NIC에 문제 발생시</p><p>예비 NIC으로 이첩시키는 기능을 합니다.  보통 IDC같은 곳에서는 이중화 보다는 같은 네트워크 </p><p>스위치에 2회선으로 물려 사용하기도 합니다. 이 모드도 장애허용에 대하여 지원됩니다.</p><p><code>Mode 2 (balance-xor)</code></p><p>XOR 방식에 따라 패킷을 전송합니다. (Source MAC Address가 Target MAC Address로 </p><p>비트연산을 하여 ) 모드 0과 비슷하지만 근원지 MAC에서 목적지 MAC으로 비트 연산을 통하여 </p><p>분배합니다. 보통 방화벽과 비슷한 방식이기는 하나 들어오는 리퀘스트에 MAC을 연결하는 </p><p>방식입니다.</p><p><code>Mode 3 (broadcast)</code></p><p>모든 NIC에 동일한 패킷을 brocast로 발송합니다. </p><p><code>Mode 4 (802.3.ad)</code></p><p>Dynamic Link Aggregation 정책으로 동작됩니다.</p><p>speed와 duplex 설정을 공유하는 aggregation groups를 스위칭 장비에서 설정하여야 합니다.</p><p>단, 802.3.ad를 지원하는 스위치에서만 사용이 가능하며, 연결대수에 상관없이 그룹화에 따라 회선의 </p><p>정책이 변경되어 무단절 인터넷 연결을 가능하게 만드는 방식입니다.</p><p><code>Mode 5 (balance-tlb)</code></p><p>로드 발랜싱 정책으로 밖으로 내보내지는 트래픽은 분산되어 송출되며, 들어오는 트래픽은 </p><p>Active되어있는 NIC으로 패킷을 받습니다. 만일 Active 되어있는 NIC의 문제로 패킷을 받지 </p><p>못하면 또다른 NIC이 실패한 NIC의 MAC Address를 물려받게 됩니다.</p><p><code>Mode 6 (balance-alb)</code></p><p>들어오는 트래픽을 분산 처리하여 받습니다. bond에서 트래픽이 많이 존재하지 않는 NIC으로 </p><p>분산됩니다. 들어오는 로드 발렌싱은 ARP negotiation을 통해서 수행됩니다. </p>
<h3 id="toc_4">Bonding Options</h3>
<p><code>miimon</code></p><p>얼마나 자주 MII link를 감시할 것인가를 0.001초 단위로 설정한다. MII는 NIC가 살아있는지를 </p><p>확인하는데 사용.  따라서 고가용성을 요하는 경우에는 MII가 필요함. NIC이 MII를 지원하는지를 </p><p>확인하기 위해서는 다음 명령을 사용한다.</p><pre><code class=""><span class="comment"># ethtool eth0 | grep Link</span>
<span class="title">Link</span> detected: <span class="built_in">yes</span>
</code></pre><p>고가용성을 위해서 bonded interface를 사용하고 한다면, NIC가 반드시 MII를 지원해야 한다. </p><p>디폴트 값은 0으로  이 기능을 사용하지 않는다.</p><p><code>downdelay</code></p><p>링크가 끊어지고 해당 링크를 disable 하기 전에 얼마나 기다릴 것인가, miimon 설정값의 </p><p>배수로 지정해야 한다.  디폴트는 0으로 이 기능을 사용하지 않는다. </p><p><code>updelay</code></p><p>downdelay의 반대로 링크를 up으로 하기 전에 기다려야 할 시간으로 miimon 값의 배수로 지정한다. </p><p>디폴트는 0으로 이 기능을 사용하지 않는다.</p><p><code>arp_interval</code></p><p>ARP 모니터링 주기를 ms 단위로 지정한다. mode가 0, 2 인 경우에 arp_interval을 사용하면, 스위치에서 </p><p>각 NIC에 패킷을 골고루 분배하도록 스위치를 설정해야 한다.</p><p><code>arp_ip_target</code></p><p>arp_interval이 enable되어 있을 경우, ARP request에 대한 target IP 주소를 지정할 수 있다.</p><p>최대로 16개를 지정할 수 있으며, 콤마로 주소를 분리한다.</p><p><code>primary</code></p><p>channel 에 속하는 인터페이스 중에 주로 사용할 것을 지정한다. NIC 중에서 성능이 </p><p>우수한 것을 주로 사용하고 나머지는 장애 대비용으로 사용할 때, 유용하다. </p><p><code>multicast</code></p><p>0 : disable multicast</p><p>1 : enable multicast, on active slave</p><p>2 : enable multicast on all slave(default)</p>
                        </div>
                        <hr />
                                            
                        <div class="row-fluid">
                            
                            <div class="pull-right">
                                <a href="/post/welcome-to-haroopress" class="btn btn-info">Welcome to haroopress <i class="icon-white icon-chevron-right"></i></a>
                            </div>
                            

                            
                            <div class="pull-left">
                                <a href="/post/how-to-clear-command-line-history" class="btn btn-info"><i class="icon-white icon-chevron-left"></i> 커맨드라인 히스토리 깨끗이 지우는 방법</a>
                            </div>
                            
                        </div>
                    

                        
                    </div>
                </div>
            </div>
            <div class="row">
            </div>
        </div>
    </div>
    <!--<div class="row">-->
        <!--<div class="offset3 span9">-->
            <!--<strong>tags</strong> :-->
            <!---->
            <!--<a href="/tag/Bonding">Bonding</a>&nbsp;-->
            <!---->
            <!--<a href="/tag/Linux">Linux</a>&nbsp;-->
            <!---->
            <!--<a href="/tag/CentOS">CentOS</a>&nbsp;-->
            <!---->
        <!--</div>-->
    <!--</div>-->
</div><!-- /container -->


        <footer class="footer">
        <div class="container">
            <div class="row">
                <div class="span12 ">
                    <div class="well">
                        <p class="pull-right"><a href="#">Back to top</a></p>
                            <strong>haroopress</strong> developed by <a href="http://twitter.com/rhiokim" target="_blank">@rhiokim</a>,<a href="http://twitter.com/haroopress" target="_blank">@haroopress</a> and source in <a href="https://github.com/rhiokim/haroopress" target="_blank">github</a><br/>
                            Designed and built with all the love in the world <a href="http://twitter.com/twitter" target="_blank">@twitter</a> by <a href="http://twitter.com/mdo" target="_blank">@mdo</a> and <a href="http://twitter.com/fat" target="_blank">@fat</a>.<br />
                            Code licensed under the <a href="http://www.apache.org/licenses/LICENSE-2.0" target="_blank">Apache License v2.0</a>. Documentation licensed under <a href="http://creativecommons.org/licenses/by/3.0/">CC BY 3.0</a>.
                    </div>
                </div>
            </div>
        </div>
    </footer>

    


</body>
</html>
